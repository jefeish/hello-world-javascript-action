name: Build Distribution

# only trigger on pull request closed events
on:
  workflow_dispatch:

jobs:
  build_dist:
    runs-on: ubuntu-latest
    steps:
    - name: install ncc
      run: |
        npm i -g @vercel/ncc
    - name: checkout code
      uses: actions/checkout@v2
    - name: build dist
      run: |
        ncc build index.js --license licenses.txt
    - name: commit dist
      uses: devops-infra/action-commit-push@master
      id: commit
      with:
        github_token: "${{ secrets.GITHUB_TOKEN }}"
        add_timestamp: true
        commit_prefix: "[ACTION]]"
        commit_message: "Automatic commit"
        force: false
        target_branch: dist/version
    - name: debug
      env:
        JOB_CONTEXT: ${{ steps.commit.outputs.branch_name }}
      run: echo "$JOB_CONTEXT"
    - name: pull-request-action
      uses: vsoch/pull-request-action@master
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        BRANCH_PREFIX: "dist/version"
        PULL_REQUEST_BRANCH: "main"