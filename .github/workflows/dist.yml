name: Close Pull Request

# only trigger on pull request closed events
on:
  workflow_dispatch:

jobs:
  build_dist:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
    - name: install ncc
      run: |
        npm i -g @vercel/ncc
    - name: checkout code
      uses: actions/checkout@v2
    - name: build dist
      run: |
        ncc build index.js --license licenses.txt

  commit_dist:
    needs: [build_dist]
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
    - name: commit action
      uses: devops-infra/action-commit-push@master
      with:
        github_token: "${{ secrets.GITHUB_TOKEN }}"
        add_timestamp: true
        commit_prefix: "[AUTO]"
        commit_message: "Automatic commit"
        force: false
        target_branch: update/version